{"ts":1351586056056,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,";(function (host) {\r\n    var _Event = {};\r\n\r\n    var eventList = []\r\n       , targetList = []\r\n\r\n    function getTargetId(target) {\r\n        var targetId = (targetId = base.ArrayIndexOf(targetList, target)) >= 0\r\n                           ? targetId\r\n                           : targetList.push(target) - 1;\r\n        return targetId;\r\n    };\r\n\r\n\r\n    _Event.addEventListener = function (target, eventName, eventHandle, option) {\r\n\r\n        option = option || {};\r\n        option.Parameter = option.Parameter || [];\r\n        //var targetList = eventList.targetList\r\n\r\n        //获取事件目标id                \r\n        var targetId = getTargetId(target)\r\n            , eventNames = eventList[eventName] = eventList[eventName] || {} //压入事件处理句柄\r\n            , eventHandles = eventNames[targetId] = eventNames[targetId] || [];\r\n            \r\n        eventHandles.eventHandleAction = eventHandles.eventHandleAction || function () { };\r\n        eventHandles.push({ target: target, eventHandle: eventHandle, Parameter: option.Parameter });\r\n\r\n        eventHandles.eventHandleAction = function (oldevts) {\r\n            return function () {\r\n                oldevts();\r\n                eventHandle.apply(target, option.Parameter);\r\n            }\r\n        } (eventHandles.eventHandleAction);\r\n    };\r\n\r\n\r\n    _Event.removeEventListener = function (target, eventName, eventHandle, option) {\r\n        var targetId = getTargetId(target)\r\n                    , eventHandles = eventList[eventName][targetId];\r\n        eventHandles.eventHandleAction = function () { };\r\n\r\n        for (var i = eventHandles.length - 1; i >= 0; i--) {\r\n\r\n            if (eventHandles[i] && eventHandles[i].eventHandle == eventHandle || !eventHandle) {\r\n                eventHandles.splice(i, 1);\r\n            }\r\n            else {\r\n                eventHandles.eventHandleAction = function (oldevts, currentHandle) {\r\n                    return function () {\r\n                        currentHandle.eventHandle.apply(currentHandle.target, currentHandle.Parameter);\r\n                        oldevts();\r\n                    }\r\n                } (eventHandles.eventHandleAction, eventHandles[i]);\r\n            }\r\n        }\r\n    };\r\n\r\n\r\n    _Event.dispatchEvent = function (target, eventName) {\r\n        switch (arguments.length) {\r\n            case 2:\r\n                var targetId = getTargetId(target),\r\n                    eventNames = eventList[eventName];\r\n                eventNames[targetId] && eventNames[targetId].eventHandleAction();\r\n                break;\r\n            case 1:\r\n                eventName = arguments[0];\r\n                for (var targetId = 0; targetId < targetList.length; targetId++) {\r\n                    var currentTarget = targetList[targetId];\r\n                    currentTarget && arguments.callee(currentTarget, eventName);\r\n                }\r\n        }\r\n    };\r\n\r\n    host = host || window;\r\n    host.Event = _Event;\r\n}) (window);"]],"start1":0,"start2":0,"length1":0,"length2":2924}]],"length":2924}
